name = "dc-api"
main = "src/index.ts"
compatibility_date = "2025-01-29"
compatibility_flags = ["nodejs_compat"]

# Custom domain (requires draftcrane.app zone on same CF account)
[[routes]]
pattern = "api.draftcrane.app"
custom_domain = true

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "dc-main"
database_id = "da753071-4176-4efa-9b7f-4f744b8e1aa2"

# R2 Bucket
[[r2_buckets]]
binding = "EXPORTS_BUCKET"
bucket_name = "dc-exports"

# KV Namespace
[[kv_namespaces]]
binding = "CACHE"
id = "15db632cefe04003a94f1e6e7460c858"

# Secrets (set via `wrangler secret put`, sourced from Infisical /dc)
# CLERK_PUBLISHABLE_KEY  - Clerk JWT verification (public key)
# CLERK_SECRET_KEY       - Clerk server-side operations
# CLERK_WEBHOOK_SECRET   - Clerk webhook signature verification
# GOOGLE_CLIENT_ID       - Google Drive OAuth
# GOOGLE_CLIENT_SECRET   - Google Drive OAuth
# OPENAI_API_KEY         - AI rewrite (frontier tier: OpenAI gpt-4o)
# CF_API_TOKEN           - Cloudflare Browser Rendering (PDF export)
# ENCRYPTION_KEY         - AES-256-GCM token encryption

# Workers AI
[ai]
binding = "AI"

[vars]
FRONTEND_URL = "https://draftcrane.app"
AI_MODEL = "gpt-4o"
AI_DEFAULT_TIER = "frontier"
API_BASE_URL = "https://api.draftcrane.app"
CLERK_ISSUER_URL = "https://viable-wombat-59.clerk.accounts.dev"
GOOGLE_REDIRECT_URI = "https://api.draftcrane.app/drive/callback"
CF_ACCOUNT_ID = "ab6cc9362f7e51ba9a610aec1fc3a833"
